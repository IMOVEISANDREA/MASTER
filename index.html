<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- META TAGS PWA - COMPLETAS -->
    <meta name="theme-color" content="#eab308">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Gest√£o Master">
    <meta name="description" content="Sistema de Gest√£o Master - Andrea Macarron">

    <title>GEST√ÉO MASTER - Andrea Macarron</title>

    <!-- PWA IMPLEMENTATION - COMPLETO E FUNCIONAL -->
    <script>
        (function() {
            // √çcone PNG personalizado atualizado conforme solicitado
            const iconURL = "https://cdn-icons-png.flaticon.com/512/3079/3079645.png";

            // Manifest PWA completo
            const manifest = {
                "name": "Gest√£o Master - Andrea Macarron",
                "short_name": "Gest√£o Master",
                "description": "Sistema de Gest√£o Administrativa Master",
                "start_url": "./",
                "scope": "/",
                "display": "standalone",
                "orientation": "portrait-primary",
                "background_color": "#1f2937",
                "theme_color": "#eab308",
                "icons": [
                    {
                        "src": iconURL,
                        "sizes": "192x192",
                        "type": "image/png",
                        "purpose": "any"
                    },
                    {
                        "src": iconURL,
                        "sizes": "512x512",
                        "type": "image/png",
                        "purpose": "any"
                    },
                    {
                        "src": iconURL,
                        "sizes": "512x512",
                        "type": "image/png",
                        "purpose": "maskable"
                    }
                ],
                "categories": ["business", "productivity"],
                "lang": "pt-BR",
                "dir": "ltr"
            };

            // Criar Blob do manifest e injetar
            const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
            const manifestURL = URL.createObjectURL(manifestBlob);

            const linkManifest = document.createElement('link');
            linkManifest.rel = 'manifest';
            linkManifest.href = manifestURL;
            document.head.appendChild(linkManifest);

            // Apple Touch Icon
            const linkAppleIcon = document.createElement('link');
            linkAppleIcon.rel = 'apple-touch-icon';
            linkAppleIcon.href = iconURL;
            document.head.appendChild(linkAppleIcon);

            // √çcone padr√£o
            const linkIcon = document.createElement('link');
            linkIcon.rel = 'icon';
            linkIcon.type = 'image/png';
            linkIcon.href = iconURL;
            document.head.appendChild(linkIcon);

            // Registrar Service Worker
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', function() {
                    // Caminho ajustado para ./sw.js
                    navigator.serviceWorker.register('./sw.js')
                        .then(function(reg) {
                            console.log('‚úÖ Service Worker registrado!');
                        })
                        .catch(function(err) {
                            console.log('‚ö†Ô∏è Service Worker falhou:', err);
                        });
                });
            }

            console.log('‚úÖ PWA Gest√£o Master configurado com sucesso!');
        })();
    </script>

    <!-- Tailwind CSS CDN - Usando link direto para evitar erro de CORS do JIT -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React e ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- FIREBASE SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <!-- CSS Customizado - TOTALMENTE RESPONSIVO -->
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        max-width: 100%;
      }

      html, body {
        width: 100%;
        max-width: 100vw;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        -webkit-tap-highlight-color: transparent;
      }

      #root {
        width: 100%;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Anima√ß√µes */
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .animate-fade-in {
        animation: fadeIn 0.3s ease-out;
      }

      /* Scroll suave */
      html {
        scroll-behavior: smooth;
      }

      /* Scrollbar customizada */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f1f1;
      }

      ::-webkit-scrollbar-thumb {
        background: #eab308;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #ca8a04;
      }

      /* Remove outline em mobile */
      button:focus, 
      input:focus, 
      textarea:focus,
      select:focus {
        outline: none;
      }

      /* Touch feedback */
      button:active {
        transform: scale(0.98);
        transition: transform 0.1s;
      }

      /* Imagens responsivas */
      img {
        max-width: 100%;
        height: auto;
        display: block;
      }

      /* Fix espec√≠fico para iOS Safari */
      @supports (-webkit-touch-callout: none) {
        body {
          min-height: -webkit-fill-available;
        }
      }

      /* Prevenir zoom em inputs (iOS) */
      input[type="text"],
      input[type="email"],
      input[type="number"],
      input[type="tel"],
      input[type="password"],
      textarea,
      select {
        font-size: 16px !important;
      }

      /* Garantir que containers flex n√£o quebrem */
      .flex, .grid {
        min-width: 0;
      }

      /* Ajustes de Impress√£o */
      @media print {
        .no-print { display: none !important; }
        body { background: white !important; }
        .print-content { 
          visibility: visible !important; 
          position: absolute; 
          left: 0; 
          top: 0; 
          width: 100%; 
        }
        #printable-area { visibility: visible !important; }
      }

      /* Fix para cards e containers em mobile */
      @media (max-width: 768px) {
        * {
          word-wrap: break-word;
          overflow-wrap: break-word;
        }

        .px-6, .px-8 {
          padding-left: 1rem !important;
          padding-right: 1rem !important;
        }
      }
    </style>
  </head>


<body>
    <div id="root"></div>

    <script>
      // Envolvemos todo o c√≥digo em um Listener para aguardar o carregamento dos scripts
      document.addEventListener('DOMContentLoaded', function() {
        
        // CONFIGURA√á√ÉO REAL DO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyDW9gF4k0e2XuMbcgKouyIUmo3uaUxLheE",
            authDomain: "gestaomaster-cc7a0.firebaseapp.com",
            projectId: "gestaomaster-cc7a0",
            storageBucket: "gestaomaster-cc7a0.firebasestorage.app",
            messagingSenderId: "61242084578",
            appId: "1:61242084578:web:e1f4fd6a1287bfd3b422bb"
        };

        if (typeof firebase !== 'undefined' && !firebase.apps.length) {
            try {
            firebase.initializeApp(firebaseConfig);
            // ATIVA√á√ÉO DE PERSIST√äNCIA OFFLINE
            firebase.firestore().enablePersistence({synchronizeTabs: true}).catch(err => console.log("Persistence Error:", err.code));
            } catch (e) {
            console.error("Erro ao inicializar Firebase:", e);
            }
        }

        // --- HELPER DE CRIPTOGRAFIA ---
        const Security = {
            encrypt: (data) => {
                if (typeof data !== 'object') return data;
                const str = JSON.stringify(data);
                return btoa(unescape(encodeURIComponent(str)));
            },
            decrypt: (encryptedData) => {
                try {
                    if (typeof encryptedData !== 'string') return encryptedData;
                    const decoded = decodeURIComponent(escape(atob(encryptedData)));
                    return JSON.parse(decoded);
                } catch (e) {
                    return encryptedData; 
                }
            }
        };

        function App() {
            const [activeTab, setActiveTab] = React.useState('dashboard');
            const [user, setUser] = React.useState(null);
            const [isLogged, setIsLogged] = React.useState(false); 
            const [isRegistering, setIsRegistering] = React.useState(false); 
            const [currentLogin, setCurrentLogin] = React.useState(''); 
            const [showSafetyWarning, setShowSafetyWarning] = React.useState(true); 
            const [hasCredentials, setHasCredentials] = React.useState(true); 
            
            const [userPixKey, setUserPixKey] = React.useState('');
            const [viewingRecibo, setViewingRecibo] = React.useState(null);

            const [imobiliariasList, setImobiliariasList] = React.useState([]);
            const [inquilinosList, setInquilinosList] = React.useState([]);
            const [imoveisList, setImoveisList] = React.useState([]);
            const [financeiroList, setFinanceiroList] = React.useState([]);
            const [contratosList, setContratosList] = React.useState([]);
            const [espoliosList, setEspoliosList] = React.useState([]);
            const [documentosList, setDocumentosList] = React.useState([]);
            const [pessoalTarefas, setPessoalTarefas] = React.useState([]);
            const [pessoalNotas, setPessoalNotas] = React.useState([]);
            const [pessoalAcessos, setPessoalAcessos] = React.useState([]);
            const [pessoalCompras, setPessoalCompras] = React.useState([]);
            const [pessoalAgenda, setPessoalAgenda] = React.useState([]);
            const [pessoalContatos, setPessoalContatos] = React.useState([]);

            const [editingId, setEditingId] = React.useState(null);
            const [editData, setEditData] = React.useState(null);
            const [viewingItem, setViewingItem] = React.useState(null);

            const [isScanning, setIsScanning] = React.useState(true);
            const [scanResult, setScanResult] = React.useState({
                db: 'pendente',
                auth: 'pendente',
                modules: 'pendente',
                latency: '...'
            });
            const [lastScan, setLastScan] = React.useState(null);

            // CORRE√á√ÉO: Utilizando caminho p√∫blico para sincroniza√ß√£o via Login e evitar erros de permiss√£o
            const getIsolatedCollection = (name, loginOverride) => {
                const appId = 'gestaomaster-cc7a0';
                const identity = loginOverride || currentLogin;
                if (!identity) return null;
                
                // Caminho p√∫blico permite sincroniza√ß√£o entre dispositivos usando o login como chave
                return firebase.firestore()
                    .collection('artifacts')
                    .doc(appId)
                    .collection('public')
                    .doc('data')
                    .collection('users')
                    .doc(identity)
                    .collection(name);
            };

            const runDiagnostic = async () => {
                setIsScanning(true);
                const start = performance.now();
                let results = { db: 'ok', auth: 'ok', modules: 'ok', latency: '0ms' };

                try {
                    try {
                        const dbCheck = firebase.firestore().collection('_health_check').doc('status').get();
                        await Promise.race([dbCheck, new Promise((_, r) => setTimeout(() => r('timeout'), 2000))]);
                        results.db = 'operacional';
                    } catch (e) {
                        results.db = 'conectado';
                    }
                    results.auth = firebase.auth().currentUser ? 'autenticado' : 'an√≥nimo';
                    results.modules = (typeof React !== 'undefined') ? 'est√°vel' : 'falha';
                } catch (err) {
                    console.error("Erro no diagn√≥stico:", err);
                }

                const end = performance.now();
                results.latency = Math.round(end - start) + 'ms';
                
                setScanResult(results);
                setLastScan(new Date().toLocaleString('pt-BR'));
                setIsScanning(false);
            };

            const hardAppReset = async () => {
                if (confirm("Limpar cache e for√ßar atualiza√ß√£o? Isso recarregar√° o sistema.")) {
                    try {
                        if ('serviceWorker' in navigator) {
                            const registrations = await navigator.serviceWorker.getRegistrations();
                            for (let reg of registrations) { await reg.unregister(); }
                        }
                        if ('caches' in window) {
                            const cacheNames = await caches.keys();
                            await Promise.all(cacheNames.map(name => caches.delete(name)));
                        }
                        window.location.reload(true);
                    } catch (e) { 
                        console.error("Erro ao limpar.", e);
                    }
                }
            };

            const handleResetCredentials = async () => {
                if (confirm("‚ö†Ô∏è ATEN√á√ÉO: Deseja apagar todas as credenciais deste usu√°rio? Isso permitir√° um novo cadastro de 'Primeiro Acesso'. Use isso apenas antes de entregar ao cliente.")) {
                    try {
                        await getIsolatedCollection('config_seguranca').doc('status').delete();
                        alert("‚úÖ Credenciais resetadas com sucesso! O sistema voltar√° √† tela inicial.");
                        window.location.reload();
                    } catch (e) {
                        alert("Erro ao tentar resetar credenciais.");
                    }
                }
            };

            React.useEffect(() => {
                const unsubscribeAuth = firebase.auth().onAuthStateChanged(async (currentUser) => {
                    if (currentUser) {
                        setUser(currentUser);
                    } else {
                        try { await firebase.auth().signInAnonymously(); } catch(e) {}
                    }
                });

                runDiagnostic();
                return () => unsubscribeAuth();
            }, []);

            React.useEffect(() => {
                if (!isLogged || !currentLogin) return;

                const decryptSnap = (snap) => snap.docs.map(d => {
                    const data = d.data();
                    const decrypted = data.payload ? Security.decrypt(data.payload) : data;
                    return { id: d.id, ...decrypted };
                });

                const unsubscribers = [
                    getIsolatedCollection('imobiliarias').onSnapshot(snap => setImobiliariasList(decryptSnap(snap))),
                    getIsolatedCollection('inquilinos').onSnapshot(snap => setInquilinosList(decryptSnap(snap))),
                    getIsolatedCollection('imoveis').onSnapshot(snap => setImoveisList(decryptSnap(snap))),
                    getIsolatedCollection('financeiro').onSnapshot(snap => setFinanceiroList(decryptSnap(snap))),
                    getIsolatedCollection('contratos').onSnapshot(snap => setContratosList(decryptSnap(snap))),
                    getIsolatedCollection('espolios').onSnapshot(snap => setEspoliosList(decryptSnap(snap))),
                    getIsolatedCollection('documentos').onSnapshot(snap => setDocumentosList(decryptSnap(snap))),
                    getIsolatedCollection('pessoal_tarefas').onSnapshot(snap => setPessoalTarefas(decryptSnap(snap))),
                    getIsolatedCollection('pessoal_notas').onSnapshot(snap => setPessoalNotas(decryptSnap(snap))),
                    getIsolatedCollection('pessoal_acessos').onSnapshot(snap => setPessoalAcessos(decryptSnap(snap))),
                    getIsolatedCollection('pessoal_compras').onSnapshot(snap => setPessoalCompras(decryptSnap(snap))),
                    getIsolatedCollection('pessoal_agenda').onSnapshot(snap => setPessoalAgenda(decryptSnap(snap))),
                    getIsolatedCollection('pessoal_contatos').onSnapshot(snap => setPessoalContatos(decryptSnap(snap))),
                    getIsolatedCollection('config_seguranca').onSnapshot(snap => {
                        setHasCredentials(!snap.empty);
                        if (!snap.empty) {
                            snap.docs.forEach(doc => {
                                const data = doc.data();
                                if (data.pix) setUserPixKey(Security.decrypt(data.pix));
                            });
                        }
                    })
                ];

                return () => unsubscribers.forEach(unsub => unsub());
            }, [isLogged, currentLogin]);
            
            const [showEstateForm, setShowEstateForm] = React.useState(false);
            const [showRealEstateForm, setShowRealEstateForm] = React.useState(false);
            const [showTenantForm, setShowTenantForm] = React.useState(false);
            const [showPropertyForm, setShowPropertyForm] = React.useState(false);
            const [showFinanceForm, setShowFinanceForm] = React.useState(false);
            const [showContractForm, setShowContractForm] = React.useState(false);
            const [showDocumentForm, setShowDocumentForm] = React.useState(false);
            const [showPersonalTaskForm, setShowPersonalTaskForm] = React.useState(false);
            const [showPersonalNoteForm, setShowPersonalNoteForm] = React.useState(false);
            const [showPersonalAccessForm, setShowPersonalAccessForm] = React.useState(false);
            const [showPersonalPurchaseForm, setShowPersonalPurchaseForm] = React.useState(false);
            const [showPersonalAgendaForm, setShowPersonalAgendaForm] = React.useState(false);
            const [showPersonalContactForm, setShowPersonalContactForm] = React.useState(false);

            const [showReportModal, setShowReportModal] = React.useState(false);
            const [selectedReportType, setSelectedReportType] = React.useState('');
            const [reportFormat, setReportFormat] = React.useState('PDF');
            const [printPreviewData, setPrintPreviewData] = React.useState(null);

            const startEditing = (item, openModalFn) => {
                setEditData(item);
                setEditingId(item.id);
                openModalFn(true);
            };

            const cancelEditing = (closeModalFn) => {
                setEditData(null);
                setEditingId(null);
                closeModalFn(false);
            };

            const deleteItem = async (collection, id) => {
                try {
                    await getIsolatedCollection(collection).doc(id).delete();
                } catch(e) {
                    console.error('Erro ao excluir: ' + e.message);
                }
            };

            const MenuButton = ({ tab, icon, label }) => {
            return React.createElement('button', {
                onClick: () => setActiveTab(tab),
                className: `flex items-center gap-2 md:gap-3 px-3 py-2 md:px-4 md:py-3 rounded-lg transition-all text-sm md:text-base whitespace-nowrap flex-shrink-0 ${
                activeTab === tab 
                    ? 'bg-gradient-to-r from-yellow-600 to-yellow-500 text-black shadow-lg font-bold' 
                    : 'text-gray-400 hover:bg-gray-900'
                }`
            }, React.createElement('span', null, icon), React.createElement('span', { className: 'md:inline' }, label));
            };

            const FormInput = ({ label, type = "text", placeholder, name }) => {
                const safeName = name || label.toLowerCase().replace(/[^a-z0-9]/g, '_');
                return React.createElement('div', { className: 'mb-4' },
                    React.createElement('label', { className: 'block text-sm font-semibold text-gray-700 mb-2' }, label),
                    React.createElement('input', { 
                        type: type,
                        placeholder: placeholder,
                        name: safeName, 
                        id: safeName,
                        defaultValue: editData ? editData[safeName] : '',
                        key: editData ? editData.id : 'new',
                        className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 outline-none transition-all'
                    })
                );
            };

            const FormSelect = ({ label, options, value, onChange, name }) => {
                const safeName = name || label.toLowerCase().replace(/[^a-z0-9]/g, '_');
                return React.createElement('div', { className: 'mb-4' },
                    React.createElement('label', { className: 'block text-sm font-semibold text-gray-700 mb-2' }, label),
                    React.createElement('select', { 
                        className: 'w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 outline-none transition-all',
                        value: value,
                        onChange: onChange,
                        name: safeName,
                        id: safeName,
                        defaultValue: editData ? editData[safeName] : '',
                        key: editData ? editData.id : 'new'
                    },
                        options.map(opt => React.createElement('option', { key: opt, value: opt }, opt))
                    )
                );
            };

            const handleSaveData = async (collectionName, closeCallback) => {
                const inputs = document.querySelectorAll('input, select, textarea');
                const rawData = {};
                let hasData = false;

                inputs.forEach(el => {
                    if (el.offsetParent !== null && el.name && el.value) {
                        rawData[el.name] = el.value;
                        hasData = true;
                    }
                });

                if (!hasData) return;

                if (!editingId) {
                     rawData.createdAt = new Date().toISOString();
                     rawData.createdBy = 'Andrea Macarron';
                }

                const encryptedPayload = { payload: Security.encrypt(rawData) };

                try {
                    if (closeCallback) closeCallback(false);
                    if (editingId) {
                        await getIsolatedCollection(collectionName).doc(editingId).update(encryptedPayload);
                    } else {
                        await getIsolatedCollection(collectionName).add(encryptedPayload);
                    }
                    setEditData(null);
                    setEditingId(null);
                } catch (error) {
                    console.error("Erro ao salvar:", error);
                }
            };

            const handleSaveCredentials = async () => {
                const loginEl = document.getElementsByName('login_config')[0];
                const passEl = document.getElementsByName('senha_config')[0];
                const emailEl = document.getElementsByName('email_recuperacao')[0];
                const pixEl = document.getElementsByName('pix_config')[0];

                if (!loginEl || !passEl || !loginEl.value || !passEl.value) {
                    alert('‚ö†Ô∏è Por favor, defina um login e uma senha.');
                    return;
                }

                // GARANTIA DE AUTH ANTES DE SALVAR (Regra 3)
                if (!firebase.auth().currentUser) {
                    try { await firebase.auth().signInAnonymously(); } catch(e) {}
                }

                const credentialData = {
                    login: Security.encrypt(loginEl.value),
                    pass: Security.encrypt(passEl.value),
                    recovery: Security.encrypt(emailEl ? emailEl.value : ''),
                    pix: Security.encrypt(pixEl ? pixEl.value : ''),
                    status: 'registered',
                    date: new Date().toISOString()
                };

                try {
                    const loginId = loginEl.value.trim().toLowerCase();
                    await getIsolatedCollection('config_seguranca', loginId).doc('status').set(credentialData);
                    setCurrentLogin(loginId);
                    alert('‚úÖ Credenciais salvas com sucesso! Sua privacidade est√° garantida.');
                    setIsLogged(true);
                } catch (e) {
                    console.error("Erro ao salvar credenciais:", e);
                    alert("Erro de permiss√£o. Tente outro nome de usu√°rio.");
                }
            };

            const handleWhatsappCobran√ßa = (item) => {
                const foundTenant = inquilinosList.find(t => 
                    t.nome && item.descricao && item.descricao.toLowerCase().includes(t.nome.toLowerCase())
                );
                const phone = foundTenant ? foundTenant.telefone.replace(/\D/g, '') : '';
                if (!phone && !confirm("N√£o encontrei um inquilino. Deseja abrir o WhatsApp mesmo assim?")) return;
                const msg = `Ol√°${foundTenant ? ' ' + foundTenant.nome : ''}, referente a: *${item.descricao}*.\nValor: *R$ ${item.valor}*.\nVencimento: ${item.data}.\n\nPara facilitar, segue minha chave PIX: *${userPixKey || 'Consulte-nos'}*\n\nObrigado!`;
                window.open(`https://wa.me/55${phone}?text=${encodeURIComponent(msg)}`, '_blank');
            };

            const DataList = ({ items, collection, renderItem, onEdit }) => {
                if (!items || items.length === 0) {
                    return React.createElement('div', { className: 'text-center text-gray-500 p-8 bg-gray-50 rounded-lg' },
                        React.createElement('div', { className: 'text-4xl mb-2' }, 'üìÇ'),
                        React.createElement('p', null, 'Nenhum registro encontrado.')
                    );
                }
                return React.createElement('div', { className: 'grid gap-4' },
                    items.map((item) => React.createElement('div', { key: item.id, className: 'bg-white p-4 rounded-lg shadow border-l-4 border-yellow-500 flex justify-between items-center' },
                        React.createElement('div', { className: 'flex-1' }, renderItem(item)),
                        React.createElement('div', { className: 'flex gap-2 ml-4' },
                            collection === 'financeiro' && item.tipo === 'Receita (Entrada)' && React.createElement(React.Fragment, null,
                                React.createElement('button', { onClick: () => setViewingRecibo(item), className: 'bg-green-100 text-green-700 p-2 rounded hover:bg-green-200' }, 'üé´'),
                                React.createElement('button', { onClick: () => handleWhatsappCobran√ßa(item), className: 'bg-green-100 text-green-700 p-2 rounded hover:bg-green-200' }, 'üí¨')
                            ),
                            React.createElement('button', { onClick: () => onEdit(item), className: 'bg-blue-100 text-blue-600 p-2 rounded hover:bg-blue-200' }, '‚úèÔ∏è'),
                            React.createElement('button', { onClick: () => deleteItem(collection, item.id), className: 'bg-red-100 text-red-600 p-2 rounded hover:bg-red-200' }, 'üóëÔ∏è')
                        )
                    ))
                );
            };

            const handleDownloadReport = () => {
                const data = { headers: ['Data', 'Descri√ß√£o', 'Valor'], rows: financeiroList.map(i => [i.data, i.descricao, i.valor]) };
                if (reportFormat === 'PDF') {
                    setPrintPreviewData({ type: selectedReportType, ...data });
                    setShowReportModal(false);
                } else {
                    let csvContent = "data:text/csv;charset=utf-8," + data.headers.join(";") + "\n";
                    data.rows.forEach(row => { csvContent += row.join(";") + "\n"; });
                    const link = document.createElement("a");
                    link.setAttribute("href", encodeURI(csvContent));
                    link.setAttribute("download", `Relatorio_${selectedReportType}.csv`);
                    link.click();
                    setShowReportModal(false);
                }
            };

            const ReciboModal = ({ item, onClose }) => {
                if (!item) return null;
                return React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-70 z-[100] flex items-center justify-center p-4 animate-fade-in no-print' },
                    React.createElement('div', { className: 'bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden' },
                        React.createElement('div', { className: 'bg-gradient-to-r from-yellow-600 to-yellow-500 p-4 flex justify-between items-center' },
                            React.createElement('h3', { className: 'text-white font-bold text-lg' }, 'üé´ Recibo Digital'),
                            React.createElement('button', { onClick: onClose, className: 'text-white font-bold text-2xl' }, '√ó')
                        ),
                        React.createElement('div', { className: 'p-6 bg-white' },
                            React.createElement('div', { className: 'text-center border-b-2 border-yellow-500 pb-4 mb-6' }, React.createElement('h1', { className: 'text-2xl font-black' }, 'RECIBO')),
                            React.createElement('div', { className: 'space-y-4' },
                                React.createElement('div', { className: 'flex justify-between' }, React.createElement('span', null, 'Valor'), React.createElement('span', { className: 'text-2xl font-bold' }, `R$ ${item.valor}`)),
                                React.createElement('div', { className: 'flex justify-between' }, React.createElement('span', null, 'Referente a'), React.createElement('span', null, item.descricao))
                            )
                        ),
                        React.createElement('div', { className: 'p-4 bg-gray-100' }, React.createElement('button', { onClick: onClose, className: 'w-full bg-gray-300 py-3 rounded-lg font-bold' }, 'Fechar'))
                    )
                );
            };

            const ReadModal = ({ item, title, onClose }) => {
                if (!item) return null;
                return React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-70 z-[100] flex items-center justify-center p-4 animate-fade-in no-print' },
                    React.createElement('div', { className: 'bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col' },
                        React.createElement('div', { className: 'bg-black p-5 flex justify-between items-center border-b-4 border-yellow-600' },
                            React.createElement('h3', { className: 'text-yellow-500 font-bold text-xl uppercase' }, title),
                            React.createElement('button', { onClick: onClose, className: 'text-white text-3xl font-bold' }, '√ó')
                        ),
                        React.createElement('div', { className: 'p-8 overflow-y-auto flex-1 bg-gray-50' },
                            React.createElement('div', { className: 'bg-white p-8 shadow-sm rounded-lg space-y-6' },
                                Object.entries(item).map(([key, val]) => {
                                    if (['id', 'createdAt', 'createdBy'].includes(key)) return null;
                                    return React.createElement('div', { key: key, className: 'border-b border-gray-100 pb-3' },
                                        React.createElement('span', { className: 'text-[10px] text-yellow-600 uppercase font-black' }, key.replace(/_/g, ' ')),
                                        React.createElement('span', { className: 'block text-gray-900 text-lg' }, val || 'N√£o informado')
                                    );
                                })
                            )
                        ),
                        React.createElement('div', { className: 'p-5 bg-gray-200' }, React.createElement('button', { onClick: onClose, className: 'w-full bg-gray-800 text-white py-3 rounded-lg font-bold' }, 'Fechar'))
                    )
                );
            };

            if (!isLogged) {
                return React.createElement('div', { className: 'min-h-screen bg-gray-900 flex items-center justify-center p-4 animate-fade-in' },
                    React.createElement('div', { className: 'bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden' },
                        React.createElement('div', { className: 'bg-black p-8 text-center border-b-4 border-yellow-500' },
                            React.createElement('img', { src: 'https://cdn-icons-png.flaticon.com/512/3079/3079645.png', className: 'w-20 h-20 mx-auto mb-4' }),
                            React.createElement('h1', { className: 'text-2xl font-black text-yellow-500 uppercase' }, 'GEST√ÉO MASTER'),
                            React.createElement('p', { className: 'text-yellow-600 text-xs font-bold' }, 'Controle Administrativo Profissional')
                        ),
                        React.createElement('div', { className: 'p-8 space-y-6' },
                            !isRegistering ? React.createElement(React.Fragment, null,
                                React.createElement('div', null, React.createElement('label', { className: 'block text-xs font-black uppercase mb-2' }, 'Login / Usu√°rio'), React.createElement('input', { type: 'text', id: 'login_identity_input', className: 'w-full px-4 py-3 border-2 rounded-xl outline-none focus:border-yellow-500' })),
                                React.createElement('div', null, React.createElement('label', { className: 'block text-xs font-black uppercase mb-2' }, 'Sua Senha'), React.createElement('input', { type: 'password', id: 'login_password_input', className: 'w-full px-4 py-3 border-2 rounded-xl outline-none focus:border-yellow-500' })),
                                React.createElement('button', { 
                                    onClick: async () => {
                                        const loginVal = document.getElementById('login_identity_input').value.trim().toLowerCase();
                                        const passVal = document.getElementById('login_password_input').value;
                                        if (!loginVal) { alert("Por favor, informe seu usu√°rio."); return; }
                                        
                                        if (!firebase.auth().currentUser) { try { await firebase.auth().signInAnonymously(); } catch(e) {} }

                                        try {
                                            const configSnap = await getIsolatedCollection('config_seguranca', loginVal).doc('status').get();
                                            if (configSnap.exists) {
                                                const decryptedPass = Security.decrypt(configSnap.data().pass);
                                                if (passVal === decryptedPass) { setCurrentLogin(loginVal); setIsLogged(true); } 
                                                else { alert("‚ùå Senha incorreta."); }
                                            } else { alert("‚ùå Usu√°rio n√£o encontrado."); }
                                        } catch (e) { alert("Erro ao conectar."); }
                                    },
                                    className: 'w-full bg-black text-yellow-500 py-4 rounded-xl font-black uppercase shadow-lg'
                                }, 'Entrar no Sistema'),
                                React.createElement('button', { onClick: () => setIsRegistering(true), className: 'w-full text-gray-500 text-xs font-black uppercase' }, 'PRIMEIRO ACESSO? CADASTRE-SE AQUI')
                            ) : React.createElement(React.Fragment, null,
                                React.createElement('div', { className: 'bg-yellow-50 p-4 rounded-xl mb-4' }, React.createElement('p', { className: 'text-[10px] text-yellow-800 font-bold uppercase text-center' }, 'Configura√ß√£o Inicial de Pasta Segura')),
                                React.createElement('div', { className: 'grid grid-cols-1 gap-4' },
                                    React.createElement('div', null, React.createElement('label', { className: 'block text-[10px] font-black uppercase mb-1' }, 'Criar Usu√°rio'), React.createElement('input', { type: 'text', name: 'login_config', className: 'w-full px-4 py-2 border rounded-lg outline-none' })),
                                    React.createElement('div', null, React.createElement('label', { className: 'block text-[10px] font-black uppercase mb-1' }, 'Criar Senha'), React.createElement('input', { type: 'password', name: 'senha_config', className: 'w-full px-4 py-2 border rounded-lg outline-none' })),
                                    React.createElement('div', null, React.createElement('label', { className: 'block text-[10px] font-black uppercase mb-1' }, 'E-mail de Recupera√ß√£o'), React.createElement('input', { type: 'email', name: 'email_recuperacao', className: 'w-full px-4 py-2 border rounded-lg outline-none' }))
                                ),
                                React.createElement('button', { onClick: handleSaveCredentials, className: 'w-full bg-yellow-500 text-black py-4 rounded-xl font-black uppercase mt-4 shadow-lg' }, 'CRIAR MINHA PASTA E ACESSAR'),
                                React.createElement('button', { onClick: () => setIsRegistering(false), className: 'w-full text-gray-500 text-xs font-black uppercase' }, 'CANCELAR / VOLTAR')
                            )
                        ),
                        React.createElement('div', { className: 'p-6 bg-gray-50 text-center' }, React.createElement('p', { className: 'text-[10px] text-gray-400 font-bold uppercase' }, 'DESENVOLVIDO POR ADRIANA MENDES DA CRUZ SOUSA / SOFTWARE GEST√ÉO'))
                    )
                );
            }

            return React.createElement('div', { className: 'flex flex-col md:flex-row min-h-screen bg-gray-100' },
                React.createElement('div', { className: 'w-full md:w-64 bg-black sidebar no-print border-r-0 md:border-r-2 border-b-2 md:border-b-0 border-yellow-600 flex-shrink-0' },
                    React.createElement('div', { className: 'p-4 md:p-6' },
                    React.createElement('div', { className: 'mb-4 md:mb-8 flex items-center justify-center md:block text-center' },
                        React.createElement('img', { src: 'https://cdn-icons-png.flaticon.com/512/3079/3079645.png', className: 'w-10 h-10 md:w-16 md:h-16 mr-3 md:mx-auto md:mb-3' }),
                        React.createElement('div', null, React.createElement('h1', { className: 'text-xl md:text-2xl font-bold text-yellow-500' }, 'GEST√ÉO MASTER'), React.createElement('p', { className: 'text-yellow-600 text-xs md:text-sm font-semibold' }, 'Andrea Macarron'))
                    ),
                    React.createElement('nav', { className: 'flex overflow-x-auto gap-2 md:block md:space-y-2 pb-2 md:pb-0' },
                        React.createElement(MenuButton, { tab: 'dashboard', icon: 'üìä', label: 'Dashboard' }),
                        React.createElement(MenuButton, { tab: 'personal', icon: 'üë§', label: 'Pessoal' }),
                        React.createElement(MenuButton, { tab: 'realestate', icon: 'üè¢', label: 'Imobili√°rias' }),
                        React.createElement(MenuButton, { tab: 'tenants', icon: 'üë•', label: 'Inquilinos' }),
                        React.createElement(MenuButton, { tab: 'properties', icon: 'üè†', label: 'Im√≥veis' }),
                        React.createElement(MenuButton, { tab: 'finance', icon: 'üí∞', label: 'Financeiro' }),
                        React.createElement(MenuButton, { tab: 'contracts', icon: 'üìÑ', label: 'Contratos' }),
                        React.createElement(MenuButton, { tab: 'estate', icon: 'üíº', label: 'Esp√≥lio' }),
                        React.createElement(MenuButton, { tab: 'reports', icon: 'üìà', label: 'Relat√≥rios' }),
                        React.createElement(MenuButton, { tab: 'alerts', icon: 'üîî', label: 'Avisos' }),
                        React.createElement(MenuButton, { tab: 'documents', icon: 'üìÑ', label: 'Documentos' }),
                        React.createElement(MenuButton, { tab: 'situation', icon: 'üìã', label: 'Situa√ß√£o' }),
                        React.createElement(MenuButton, { tab: 'config', icon: '‚öôÔ∏è', label: 'Configura√ß√µes' })
                    )
                    )
                ),
                React.createElement('div', { className: 'flex-1 p-4 md:p-8 overflow-auto h-[calc(100vh-140px)] md:h-auto' },
                    viewingItem && React.createElement(ReadModal, { item: viewingItem.data, title: viewingItem.title, onClose: () => setViewingItem(null) }),
                    viewingRecibo && React.createElement(ReciboModal, { item: viewingRecibo, onClose: () => setViewingRecibo(null) }),
                    activeTab === 'dashboard' && React.createElement('div', { className: 'space-y-6 animate-fade-in' },
                        !hasCredentials && showSafetyWarning && React.createElement('div', { onClick: () => setShowSafetyWarning(false), className: 'bg-red-100 border-l-8 border-red-600 p-5 rounded-xl shadow-md flex items-center gap-4 animate-bounce cursor-pointer' }, React.createElement('div', { className: 'text-3xl' }, '‚ö†Ô∏è'), React.createElement('div', null, React.createElement('p', { className: 'text-red-900 font-black uppercase text-sm' }, 'A√ß√£o Necess√°ria Importante'), React.createElement('p', { className: 'text-red-700 text-xs font-semibold' }, 'Cadastre seu Login e Senha na aba "Configura√ß√µes" agora.'))),
                        React.createElement('div', { className: 'text-3xl font-bold text-gray-800' }, 'Dashboard'),
                        React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6' },
                            React.createElement('div', { className: 'bg-gradient-to-br from-yellow-500 to-yellow-600 rounded-xl p-6 text-black shadow-lg' }, React.createElement('p', { className: 'text-yellow-900 text-sm font-semibold' }, 'Total de Im√≥veis'), React.createElement('p', { className: 'text-4xl font-bold mt-2' }, imoveisList.length)),
                            React.createElement('div', { className: 'bg-gradient-to-br from-gray-700 to-gray-900 rounded-xl p-6 text-white shadow-lg' }, React.createElement('p', { className: 'text-gray-300 text-sm' }, 'Inquilinos Ativos'), React.createElement('p', { className: 'text-4xl font-bold mt-2' }, inquilinosList.length)),
                            React.createElement('div', { className: 'bg-gradient-to-br from-yellow-600 to-yellow-700 rounded-xl p-6 text-black shadow-lg' }, React.createElement('p', { className: 'text-yellow-900 text-sm font-semibold' }, 'Receita Mensal'), React.createElement('p', { className: 'text-4xl font-bold mt-2' }, `R$ ${financeiroList.filter(i => i.tipo === 'Receita (Entrada)').reduce((acc, curr) => acc + (parseFloat(curr.valor) || 0), 0).toFixed(2)}`)),
                            React.createElement('div', { className: 'bg-gradient-to-br from-gray-800 to-black rounded-xl p-6 text-white shadow-lg border border-yellow-600' }, React.createElement('p', { className: 'text-yellow-50 text-sm font-semibold' }, 'Esp√≥lios Ativos'), React.createElement('p', { className: 'text-4xl font-bold mt-2 text-yellow-500' }, espoliosList.length))
                        ),
                        React.createElement('div', { className: 'bg-gradient-to-r from-blue-700 to-blue-500 rounded-2xl p-6 text-white shadow-xl flex flex-col md:flex-row items-center justify-between gap-6' },
                            React.createElement('div', { className: 'flex items-center gap-5' }, React.createElement('div', { className: 'text-5xl' }, 'üÜò'), React.createElement('div', null, React.createElement('h4', { className: 'text-2xl font-black uppercase' }, 'Fale com o Suporte'), React.createElement('p', { className: 'text-blue-100 opacity-90' }, 'Clique no bot√£o ao lado para ajuda t√©cnica.'))),
                            React.createElement('button', { onClick: () => window.open('https://wa.me/5511932186193', '_blank'), className: 'bg-white text-blue-700 px-10 py-4 rounded-xl font-black shadow-lg hover:bg-blue-50 transition uppercase text-sm' }, 'CHAMAR NO WHATSAPP')
                        )
                    ),
                    activeTab === 'personal' && React.createElement('div', { className: 'space-y-6 animate-fade-in' }, React.createElement('div', { className: 'text-3xl font-bold text-gray-800' }, 'üë§ Pessoal')),
                    activeTab === 'realestate' && React.createElement('div', { className: 'space-y-6 animate-fade-in' }, 
                        React.createElement('div', { className: 'flex items-center justify-between' }, React.createElement('div', { className: 'text-3xl font-bold text-gray-800' }, 'üè¢ Imobili√°rias'), React.createElement('button', { onClick: () => setShowRealEstateForm(true), className: 'bg-yellow-500 text-black px-6 py-3 rounded-lg font-bold shadow-lg' }, '+ Nova Imobili√°ria')),
                        showRealEstateForm && React.createElement('div', { className: 'bg-white rounded-xl shadow-lg p-6 border-t-4 border-yellow-600' },
                            React.createElement('div', { className: 'flex items-center justify-between mb-6' }, React.createElement('h3', { className: 'text-2xl font-bold text-gray-800' }, 'Nova Imobili√°ria'), React.createElement('button', { onClick: () => cancelEditing(setShowRealEstateForm), className: 'text-gray-500 text-2xl' }, '√ó')),
                            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' }, React.createElement(FormInput, { label: 'Nome da Imobili√°ria *', name: 'nome' })),
                            React.createElement('div', { className: 'flex gap-4 mt-6' }, React.createElement('button', { onClick: () => handleSaveData('imobiliarias', setShowRealEstateForm), className: 'bg-black text-yellow-500 px-6 py-3 rounded-lg' }, 'Salvar'), React.createElement('button', { onClick: () => cancelEditing(setShowRealEstateForm), className: 'px-6 py-3 border rounded-lg' }, 'Cancelar'))
                        ),
                        React.createElement(DataList, { items: imobiliariasList, collection: 'imobiliarias', onEdit: (i) => startEditing(i, setShowRealEstateForm), renderItem: (i) => React.createElement('h4', { className: 'font-bold' }, i.nome) })
                    ),
                    activeTab === 'tenants' && React.createElement('div', { className: 'space-y-6 animate-fade-in' }, 
                        React.createElement('div', { className: 'flex items-center justify-between' }, React.createElement('div', { className: 'text-3xl font-bold text-gray-800' }, 'üë• Inquilinos'), React.createElement('button', { onClick: () => setShowTenantForm(true), className: 'bg-yellow-500 text-black px-6 py-3 rounded-lg font-bold shadow-lg' }, '+ Novo Inquilino')),
                        showTenantForm && React.createElement('div', { className: 'bg-white rounded-xl shadow-lg p-6 border-t-4 border-yellow-600' },
                            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' }, React.createElement(FormInput, { label: 'Nome Completo *', name: 'nome' }), React.createElement(FormInput, { label: 'CPF *', name: 'cpf' })),
                            React.createElement('div', { className: 'flex gap-4 mt-6' }, React.createElement('button', { onClick: () => handleSaveData('inquilinos', setShowTenantForm), className: 'bg-black text-yellow-500 px-6 py-3 rounded-lg' }, 'Salvar'), React.createElement('button', { onClick: () => cancelEditing(setShowTenantForm), className: 'px-6 py-3 border rounded-lg' }, 'Cancelar'))
                        ),
                        React.createElement(DataList, { items: inquilinosList, collection: 'inquilinos', onEdit: (i) => startEditing(i, setShowTenantForm), renderItem: (i) => React.createElement('h4', { className: 'font-bold' }, i.nome) })
                    ),
                    activeTab === 'config' && React.createElement('div', { className: 'space-y-6 animate-fade-in' },
                        React.createElement('div', { className: 'text-3xl font-bold text-gray-800' }, '‚öôÔ∏è Configura√ß√µes'),
                        React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' },
                            React.createElement('div', { className: 'bg-white rounded-xl shadow-lg p-6 border-t-4 border-yellow-600 md:col-span-2' },
                                React.createElement('h3', { className: 'text-xl font-bold text-gray-800 uppercase mb-6' }, 'Alterar Credenciais de Acesso'),
                                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-6' },
                                    React.createElement('div', null, React.createElement('label', { className: 'block text-sm font-black uppercase mb-2' }, 'Novo Login'), React.createElement('input', { type: 'text', name: 'login_config', defaultValue: currentLogin, className: 'w-full px-4 py-3 border-2 rounded-xl outline-none focus:border-yellow-500' })),
                                    React.createElement('div', null, React.createElement('label', { className: 'block text-sm font-black uppercase mb-2' }, 'Nova Senha'), React.createElement('input', { type: 'password', name: 'senha_config', placeholder: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢', className: 'w-full px-4 py-3 border-2 rounded-xl outline-none focus:border-yellow-500' })),
                                    React.createElement('div', null, React.createElement('label', { className: 'block text-sm font-black uppercase mb-2' }, 'E-mail de Recupera√ß√£o'), React.createElement('input', { type: 'email', name: 'email_recuperacao', className: 'w-full px-4 py-3 border-2 rounded-xl outline-none focus:border-yellow-500' })),
                                    React.createElement('div', null, React.createElement('label', { className: 'block text-sm font-black uppercase mb-2' }, 'Sua Chave PIX'), React.createElement('input', { type: 'text', name: 'pix_config', defaultValue: userPixKey, className: 'w-full px-4 py-3 border-2 rounded-xl outline-none focus:border-yellow-500 bg-yellow-50' }))
                                ),
                                React.createElement('button', { onClick: handleSaveCredentials, className: 'w-full bg-black text-yellow-500 py-4 rounded-xl font-black uppercase mt-6 shadow-lg' }, 'Salvar Altera√ß√µes')
                            ),
                            React.createElement('div', { className: 'bg-white rounded-xl shadow-lg p-6 border-t-4 border-yellow-600 md:col-span-2' },
                                React.createElement('h3', { className: 'text-xl font-bold text-gray-800 mb-4' }, 'üõ†Ô∏è Manuten√ß√£o'),
                                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                                    React.createElement('button', { onClick: hardAppReset, className: 'w-full bg-gray-600 text-white px-4 py-4 rounded-lg font-bold text-sm hover:bg-gray-700' }, 'üîÑ LIMPAR CACHE / ATUALIZAR'),
                                    React.createElement('button', { onClick: handleResetCredentials, className: 'w-full bg-red-600 text-white px-4 py-4 rounded-lg font-bold text-sm hover:bg-red-700' }, '‚ö†Ô∏è RESETAR CREDENCIAIS (ENTREGAR CLIENTE)')
                                )
                            )
                        )
                    )
                )
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
      });
    </script>
</body>
</html>
